## 微信分享踩过的坑  
### 项目中的内部问题  
1. 无法进入调用微引擎的控制器  
原因：由于过滤器验证权限的时候拦截，需要登录后才能访问该接口  
解决：需要在securityConfiguration中，特指该接口允许静默授权（permitAll）  

### 微信自带bug
1. 签名返回成功，微信验证签名失败  
原因：
1、服务器时间问题，因为签名需要时间戳生成；  
2、二次分享时，第一次分享出的链接可能微信在url添加了其他查询参数导致签名错误，且使用encodeURIComponent也无效
解决：
    1、同步服务器时间  
    2、将新增的url在函数初始化的时候（生成签名之前），判断location.search是否有相应的字段（appinstall/from/sec/timekey）  
    ```JavaScript
    //相应的正则匹配  
    //?a=2&c=12
    var reg = new RegExp("(^|&) + name + =([^&]*)(&|$)",'i')
    var r = url.match(reg);
    if(r!null){
       //则将当前地址设为去除新增参数的原始url
    }
    //r[0]是全部字符串，r[1]是key,r[2]是值
    ```

2. 签名返回成功，域名没有权限  
原因：微信公众号没有将安全js接口的域名与授权页面域名配置成一致的域名   
解决：将两个域名设置为一致  

3. 图片显示问题
原因：不知道，初步认为与域名有关
解决：将新增的demo显示的图片地址设为以前旧的地址就可以了
