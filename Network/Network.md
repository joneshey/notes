# 计算机网络知识点整理

### 网络协议特点
- 支持客户/服务器模式。
- 简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、 HEAD、POST。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。
- 灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。
- 无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求， 并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
- 无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息。解决办法： 通过Cookie或者Session会话保存。
缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。
另一方面，在服务器不需要先前信息时它的应答就较快

### 网络结构体系
OSI（七层）：应用层 > 表示层 > 回话层 > 传输层 > 网络层（路由器） > 链路层（交换器） > 物理层   
TCP/IP（四层）：应用层 http> 运输层 tcp、udp> 网际层 ip> 网络接口层   
五层体系：将网络接口层分为链路和物理层  
> TCP与UDP区别：
> - TCP:
> 1. 有连接
> 2. 安全可靠协议
> 3. 以流进行数据传递，无大小限制
> 4. 三次握手协议，四次挥手
> 5. 全双工通信
> - UDP:
> 1. 无连接
> 2. 不可靠协议
> 3. 以数据包传递，有大小限制64K

### 网络三要素
IP:主机的唯一表示 （http://202.108.22.5/）  
端口号：正在运行的程序（0~65535）  
协议：通信规则，TCP以及UDP  

### 短连接和长连接
- http1.1默认(长连接)：socket
使用长连接的HTTP协议会在响应头加入一行代码：Connection:keep-Alive。  
客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，如果客户端再次去访问这个服务器上面的网页，会继续使用这一条已经建立的连接。  
Keep-Alive不会永久保持连接的，它会有一个保持时间，可以再不同的服务器软件上去设动这个时间。  
实现长连接需要服务器和客户端都支持长连接。 

- http1.0默认(短连接): 
浏览器和服务器每进行一次HTTP操作，就建立一次连接，任务结束以后中断连接。  
当客户端浏览器再次访问西苑的时候，就需要重新建立会话。

### 响应网址请求的过程
1. 客户端浏览器通过DNS解析到`www.baidu.com`的IP地址220.181.27.48，通过这个IP地址找到客户端到服务器的路径。
客户端浏览器发起一个HTTP会话到220.161.27.48，然后通过TCP进行封装数据包，输入到网络层。
2. 在客户端的传输层(添加TCP头)，把HTTP会话请求分成报文段，添加源和目的端口，如服务器使用80端口监听客户端的请求，客户端由系统随机选择一个端口如5000，与服务器进行交换，服务器把相应的请求返回给客户端的5000端口。然后使用IP层的IP地址查找目的端。
3. 客户端的网络层（添加IP头）不用关系应用层或者传输层的东西，主要做的是通过查找路由表确定如何到达服务器，期间可能经过多个路由器，这些都是由路由器来完成的工作，我不作过多的描述，无非就是通过查找路由表决定通过那个路径到达服务器。
4. 客户端的链路层（添加MAC头），包通过链路层发送到路由器，通过邻居协议查找给定IP地址的MAC地址，然后发送ARP请求查找目的地址，如果得到回应后就可以使用ARP的请求应答交换的IP数据包现在就可以传输了，然后发送IP数据包到达服务器的地址。


事件顺序

(1) 浏览器获取输入的域名`www.baidu.com`

(2) 浏览器获取域名系统DNS解析出百度服务器的IP地址

(3) 浏览器向服务器发出HTTP请求，与服务器建立TCP三次握手连接  
请求生成一个HTTP数据包，并含有TCP、IP、以太网协议的头部信息。TCP头部信息包括本机端口和目标端口号等信息，用于标识同一个主机的不同进程，对于HTTP协议，服务器端的默认端口号是80。IP头部主要包含本地IP和目标IP等信息。以太网协议头部主要是双方的MAC地址。  
> 三次握手：
> 第一次握手：客户端发送syn包(seq=x)到服务器，并进入SYN_SEND(发送)状态，等待服务器确认；
> 第二次握手：服务器收到syn包，必须确认客户的SYN（ack=x+1），同时自己也发送一个SYN包（seq=y），即SYN+ACK包，此时服务器进入SYN_RECV（接收）状态；
> 第三次握手：客户端收到服务器的SYN＋ACK包，向服务器发送确认包ACK(ack=y+1)，此包发送完毕，客户端和服务器进入ESTABLISHED（已建立）状态，完成三次握手。
> 防止连接请求报文失效后又传送到服务器（没有收到服务器的确认响应），如果不进行第三次握手，则服务器会一直等待浏览器发送数据
![](http://img.blog.csdn.net/20160312165945882?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

图源：牛客网讨论区

(4) 服务器返回HTTP响应给浏览器

(5) 浏览器对相应进行解码渲染，并将Web页显示给用户。

(6) 浏览器发送异步请求
